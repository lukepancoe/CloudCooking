DROP TABLE IF EXISTS IngredientsInRecipes;
DROP TABLE IF EXISTS Ingredients;
DROP TABLE IF EXISTS Recipes;


CREATE TABLE Ingredients (
	ingredient_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	name TEXT NOT NULL
)ENGINE=INNODB;

CREATE TABLE Recipes (
	recipe_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	name TEXT NOT NULL,
	instructions TEXT
)ENGINE=INNODB;

CREATE TABLE IngredientsInRecipes (
	recipe_id INT,
	ingredient_id INT,
	PRIMARY KEY (recipe_id, ingredient_id),
	FOREIGN KEY (recipe_id) REFERENCES Recipes(recipe_id),
	FOREIGN KEY (ingredient_id) REFERENCES Ingredients(ingredient_id)
)ENGINE=INNODB;

/*
CREATE TABLE Steps (
	step_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	step_text TEXT NOT NULL
)ENGINE=INNODB;

CREATE TABLE StepsInRecipes (
	step_id INT,
	recipe_id INT,
	step_number INT
)ENGINE=INNODB;
*/


INSERT INTO Ingredients (name) VALUES 	('chicken'), ('broccoli'), ('pork'), ('peas'), ('black beans'), 
					('spaghetti'), ('pesto'), ('ground beef'), ('milk'), ('cheddar cheese'),
					('macaroni'), ('butter'), ('flour'), ('sugar'), ('salt'), ('bread'), ('eggs'),
					('tomato sauce'), ('rice'), ('soy sauce');

INSERT INTO Recipes (name, instructions) VALUES 	('stir fry', 'Stir and fry stuff</br>Add soy sauce'), ('spaghetti with meatballs', 'Make the spaghetti'), ('pesto pasta', 'Shred basil</br>Mix it all together'), ('mac and cheese', 'mix in cheese please');

INSERT INTO IngredientsInRecipes (recipe_id, ingredient_id) VALUES (1, 1), (1, 2), (1, 3), (1, 4), (1, 15), (1,17), (1,19), (1, 20);
INSERT INTO IngredientsInRecipes (recipe_id, ingredient_id) VALUES (2, 6), (2, 8), (2, 15), (2, 18);
INSERT INTO IngredientsInRecipes (recipe_id, ingredient_id) VALUES (3, 7);
INSERT INTO IngredientsInRecipes (recipe_id, ingredient_id) VALUES (4, 10); 


SELECT r.name, i.name  FROM Ingredients i, Recipes r, IngredientsInRecipes ir WHERE i.ingredient_id = ir.ingredient_id AND r.recipe_id = ir.recipe_id;
SELECT i.name FROM Ingredients i;
SELECT r.name FROM Recipes r;


SELECT r.name, r.instructions FROM Recipes r WHERE r.name LIKE '%stir%fry%';
/* find all ingredients for a single recipe 'stir fry' */
SELECT r.name, i.name FROM Ingredients i, Recipes r, IngredientsInRecipes ir WHERE r.name = 'stir fry' AND r.recipe_id = ir.recipe_id AND i.ingredient_id = ir.ingredient_id;
/* find all recipes with a single ingredient 'salt' */
SELECT r.name, i.name FROM Ingredients i, Recipes r, IngredientsInRecipes ir WHERE i.name = 'salt' AND r.recipe_id = ir.recipe_id AND i.ingredient_id = ir.ingredient_id;
